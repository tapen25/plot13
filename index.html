<body>
  <h2 id="cadence">ã‚±ã‚¤ãƒ‡ãƒ³ã‚¹: è¨ˆæ¸¬ä¸­...</h2>
  <h2 id="status">çŠ¶æ…‹: æº–å‚™ä¸­</h2>
  <button id="startBtn">ã‚»ãƒ³ã‚µãƒ¼ã‚’è¨±å¯ã—ã¦é–‹å§‹</button>

  <script>
    const startBtn = document.getElementById("startBtn");
    const cadenceEl = document.getElementById("cadence");
    const statusEl = document.getElementById("status");

    let lastAcc = 0;
    let stepTimestamps = [];

    function processMotion(event) {
      const accY = event.accelerationIncludingGravity.y;
      const now = Date.now();

      // é–¾å€¤ã‚’è¶…ãˆãŸç¬é–“ã‚’ã‚¹ãƒ†ãƒƒãƒ—ã¨ã¿ãªã™
      if (accY - lastAcc > 2) {
        stepTimestamps.push(now);
        // 5ç§’ã‚ˆã‚Šå¤ã„ãƒ‡ãƒ¼ã‚¿ã‚’å‰Šé™¤
        stepTimestamps = stepTimestamps.filter(t => now - t < 5000);

        // ã‚±ã‚¤ãƒ‡ãƒ³ã‚¹ï¼ˆspm = æ­©/åˆ†ï¼‰
        const cadence = (stepTimestamps.length * 60) / 5;
        cadenceEl.textContent = `ã‚±ã‚¤ãƒ‡ãƒ³ã‚¹: ${cadence.toFixed(0)} spm`;

        // çŠ¶æ…‹åˆ†é¡
        let state = "é™æ­¢ ğŸ§";
        if (cadence > 10 && cadence < 120) state = "æ­©è¡Œ ğŸš¶";
        else if (cadence >= 120) state = "æ—©æ­©ã ğŸƒâ€â™€ï¸";

        statusEl.textContent = `çŠ¶æ…‹: ${state}`;
      }

      lastAcc = accY;
    }

    startBtn.addEventListener("click", async () => {
      if (typeof DeviceMotionEvent.requestPermission === "function") {
        const response = await DeviceMotionEvent.requestPermission();
        if (response !== "granted") {
          alert("ã‚»ãƒ³ã‚µãƒ¼ã®ã‚¢ã‚¯ã‚»ã‚¹ãŒæ‹’å¦ã•ã‚Œã¾ã—ãŸã€‚");
          return;
        }
      }

      window.addEventListener("devicemotion", processMotion);
      startBtn.disabled = true;
      statusEl.textContent = "è¨ˆæ¸¬ä¸­...";
    });
  </script>
</body>
